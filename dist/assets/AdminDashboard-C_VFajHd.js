import{r as a,A as E,u as M,j as e,a as p}from"./index-c3ra4aFo.js";function F(){const{logout:v}=a.useContext(E),[l,S]=a.useState([]),[r,k]=a.useState(null),[x,u]=a.useState([]),[c,g]=a.useState([]),[j,o]=a.useState(!1),[f,y]=a.useState(null),[d,A]=a.useState(""),U=M();a.useEffect(()=>{(async()=>{try{o(!0);const t=await p.getAllUsers();S(t)}catch(t){y("Failed to load users"),console.error("Error fetching users:",t)}finally{o(!1)}})()},[]),a.useEffect(()=>{if(!r){u([]),g([]);return}(async()=>{try{o(!0);const t=await p.getUserSubjects(r.id);u(t);const n=await p.getUserAttendance(r.id);g(n)}catch(t){y("Failed to load user data"),console.error("Error fetching user data:",t)}finally{o(!1)}})()},[r]);const L=s=>{const t=l.find(n=>n.id===s);k(t||null)},C=()=>{v(),U("/admin/login")},N=a.useMemo(()=>{if(!d.trim())return l;const s=d.toLowerCase();return l.filter(t=>t.username?.toLowerCase().includes(s)||t.email?.toLowerCase().includes(s))},[l,d]),w=a.useMemo(()=>!x.length||!c.length?[]:x.map(t=>{const n=c.filter(i=>i.subject?.id===t.id),h=n.filter(i=>i.status==="Present").length,b=n.filter(i=>i.status==="Absent").length,m=h+b,D=m>0?Math.round(h/m*100):0;return{...t,present:h,absent:b,total:m,percentage:D}}),[x,c]);return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("header",{className:"bg-purple-700 text-white shadow-md",children:e.jsxs("div",{className:"container mx-auto px-4 py-3 flex justify-between items-center",children:[e.jsx("h1",{className:"text-xl font-bold",children:"Admin Dashboard"}),e.jsx("button",{onClick:C,className:"bg-purple-800 hover:bg-purple-900 px-3 py-1 rounded-md text-sm",children:"Logout"})]})}),e.jsxs("main",{className:"container mx-auto py-6 px-4",children:[f&&e.jsx("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6",role:"alert",children:e.jsx("p",{children:f})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 md:col-span-1",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Users"}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:e.jsx("svg",{className:"w-4 h-4 text-gray-500","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 20 20",children:e.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"})})}),e.jsx("input",{type:"search",className:"block w-full p-2 pl-10 text-sm border border-gray-300 rounded-lg bg-gray-50 focus:ring-purple-500 focus:border-purple-500",placeholder:"Search users...",value:d,onChange:s=>A(s.target.value)})]})}),j&&!l.length?e.jsx("p",{className:"text-gray-500",children:"Loading users..."}):e.jsx("div",{className:"max-h-[500px] overflow-y-auto",children:e.jsxs("ul",{className:"space-y-2",children:[N.map(s=>e.jsx("li",{children:e.jsxs("button",{className:`w-full text-left px-3 py-2 rounded-md ${r?.id===s.id?"bg-purple-100 text-purple-700":"hover:bg-gray-100"}`,onClick:()=>L(s.id),children:[e.jsx("div",{className:"font-medium",children:s.username}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})},s.id)),N.length===0&&e.jsx("li",{className:"text-gray-500 text-center py-2",children:d?"No matching users found":"No users found"})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6 md:col-span-3",children:r?e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4",children:[r.username,"'s Data"]}),j?e.jsx("p",{className:"text-gray-500",children:"Loading user data..."}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Subjects and Attendance Statistics"}),w.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Subject"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Present"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Absent"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Classes Held"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Attendance %"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:w.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap font-medium",children:s.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-green-600",children:s.present}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-red-600",children:s.absent}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.total}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2.5 mr-2",children:e.jsx("div",{className:`h-2.5 rounded-full ${s.percentage>=75?"bg-green-500":s.percentage>=60?"bg-yellow-500":"bg-red-500"}`,style:{width:`${s.percentage}%`}})}),e.jsxs("span",{className:`text-xs font-medium ${s.percentage>=75?"text-green-700":s.percentage>=60?"text-yellow-700":"text-red-700"}`,children:[s.percentage,"%"]})]})})]},s.id))})]})}):e.jsx("p",{className:"text-gray-500",children:"No subjects found for this user"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Attendance Records"}),c.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Subject"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.subject?.name||"â€”"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:new Date(s.date).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${s.status==="Present"?"bg-green-100 text-green-800":s.status==="Absent"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:s.status})})]},s.id))})]})}):e.jsx("p",{className:"text-gray-500",children:"No attendance records found"})]})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-400",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})}),e.jsx("p",{className:"text-lg",children:"Select a user to view their data"})]})})]})]})]})}export{F as default};
